
<!DOCTYPE html>
<html>
<body>
<p>Redirecting...</p>

<script>
const code = new URLSearchParams(location.search).get("c");
if(!code){
  document.body.innerText = "Invalid link";
  throw "";
}

const STEP_KEY = "step_" + code;
let step = Number(localStorage.getItem(STEP_KEY) || 0) + 1;
localStorage.setItem(STEP_KEY, step);

const DB =
"https://linksnapp-405bb-default-rtdb.asia-southeast1.firebasedatabase.app/links/"+code+".json";

fetch(DB).then(r=>r.json()).then(d=>{
  if(!d || !d.url){
    document.body.innerText = "Link not found";
    return;
  }

  // STEP 1 → AD PAGE 1
  if(step === 1){
    location.href = "https://linksnap-redirect.pages.dev/page1.html
+ code;
    return;
  }

  // STEP 2 → AD PAGE 2
  if(step === 2){
    location.href = "https://linksnap-redirect.pages.dev/page2.html
 + code;
    return;
  }

  // STEP 3 → ORIGINAL SITE
  localStorage.removeItem(STEP_KEY);
  location.href = d.url;
});
</script>

</body>
</html>
